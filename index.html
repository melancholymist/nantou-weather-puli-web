<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å—æŠ•åŸ”é‡Œ 3 å¤©å¤©æ°£å°å¹«æ‰‹</title>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #f5f5f5;
      color: #222;
    }

    .page {
      max-width: 1440px;
      margin: 0 auto;
      padding: 16px;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .subtitle {
      font-size: 16px;
      margin-bottom: 16px;
    }

    .cards {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background-color: #fff;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }

    .card-date {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .card-summary {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
    }

    .card-row {
      font-size: 18px;
      margin-bottom: 4px;
    }

    .card-row span.label {
      font-weight: bold;
    }

    .card-advice {
      margin-top: 8px;
      font-size: 16px;
      line-height: 1.5;
    }

    /* æ¡Œæ©Ÿç‰ˆï¼šå¯¬åº¦è¶³å¤ æ™‚ä¸‰æ¬„æ’åˆ— */
    @media (min-width: 768px) {
      .cards {
        flex-direction: row;
      }
      .card {
        flex: 1;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1>å—æŠ•ç¸£åŸ”é‡Œé® æœªä¾† 3 å¤©å¤©æ°£</h1>
    <div class="subtitle">
      æœ¬é è³‡è¨Šåƒ…ä¾›ä¸€èˆ¬ç”Ÿæ´»æé†’ï¼Œå¦‚æœ‰ä¸é©è«‹ä¾é†«å¸«å»ºè­°ç‚ºä¸»ã€‚
    </div>

    <div class="cards" id="cards">
      <!-- JavaScript ä¹‹å¾Œæœƒåœ¨é€™è£¡å¹«ä½ å¡å¡ç‰‡ -->
    </div>

    <div id="error-message" style="display:none; margin-top:12px; font-size:14px; color:#b00020;">
      ç›®å‰æ°£è±¡è³‡æ–™æš«æ™‚ç„¡æ³•è®€å–ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚
    </div>
  </div>

  <script>
    // é€™å€‹ç¶²å€å°±æ˜¯ä½ æœ¬æ©Ÿçš„å¾Œç«¯ API ä½å€
    const API_URL = "http://127.0.0.1:3100/api/weather/puli";

    // é é¢è¼‰å…¥å¾Œå°±åŸ·è¡Œ
    loadWeather();

    // 1ï¸âƒ£ ä¸»è¦å…¥å£ï¼šè² è²¬å»å¾Œç«¯æ‹¿è³‡æ–™
    async function loadWeather() {
      const cardsEl = document.getElementById("cards");
      const errorEl = document.getElementById("error-message");

      console.log("ğŸ‘‰ loadWeather è¢«å‘¼å«äº†");

      // å…ˆæ¸…ç©ºç•«é¢ï¼Œé¡¯ç¤ºã€Œè¼‰å…¥ä¸­ã€
      cardsEl.innerHTML = "<p style='font-size:16px;'>è³‡æ–™è¼‰å…¥ä¸­â€¦</p>";
      errorEl.style.display = "none";

      try {
        console.log("ğŸ‘‰ æº–å‚™å‘¼å« APIï¼š", API_URL);
        const res = await fetch(API_URL);
        console.log("ğŸ‘‰ æ”¶åˆ°å›æ‡‰ï¼Œstatus =", res.status);

        if (!res.ok) {
          throw new Error("ä¼ºæœå™¨å›æ‡‰éŒ¯èª¤ï¼Œç‹€æ…‹ç¢¼ï¼š" + res.status);
        }

        const data = await res.json();
        console.log("ğŸ‘‰ è§£æå¾Œçš„ JSONï¼š", data);

        renderWeather(data);
      } catch (err) {
        console.error("âŒ å‘¼å« API ç™¼ç”ŸéŒ¯èª¤ï¼š", err);
        cardsEl.innerHTML = "";
        errorEl.style.display = "block";
      }
    }

    // 2ï¸âƒ£ è² è²¬æŠŠæ‹¿åˆ°çš„è³‡æ–™ï¼Œè®Šæˆå¡ç‰‡
    function renderWeather(data) {
      const cardsEl = document.getElementById("cards");
      cardsEl.innerHTML = ""; // æ¸…ç©ºèˆŠå…§å®¹

      console.log("ğŸ‘‰ æº–å‚™æ¸²æŸ“è³‡æ–™ï¼š", data);

      if (!data || !Array.isArray(data.days)) {
        cardsEl.innerHTML = "<p style='font-size:16px;'>ç›®å‰æ²’æœ‰å¯é¡¯ç¤ºçš„å¤©æ°£è³‡æ–™ã€‚</p>";
        return;
      }

      data.days.forEach(function (day) {
        const card = document.createElement("div");
        card.className = "card";

        const dateText = formatDate(day.date);

        card.innerHTML = `
          <div class="card-date">${dateText}</div>
          <div class="card-summary">${day.summary}</div>
          <div class="card-row"><span class="label">æº«åº¦ï¼š</span>${day.tempMin}Â°C â€“ ${day.tempMax}Â°C</div>
          <div class="card-row"><span class="label">é™é›¨æ©Ÿç‡ï¼š</span>${day.rainProb}%</div>
          <div class="card-row"><span class="label">æ¿•åº¦ï¼š</span>ç´„ ${day.humidity}%</div>
          <div class="card-advice">
            å»ºè­°ï¼š${day.advice}
          </div>
        `;

        cardsEl.appendChild(card);
      });
    }

    // 3ï¸âƒ£ æŠŠ 2025-11-29 é€™ç¨®æ ¼å¼ï¼Œè®Šæˆ 11/29ï¼ˆå…­ï¼‰
    function formatDate(dateStr) {
      if (!dateStr) return "";

      const date = new Date(dateStr);
      if (isNaN(date.getTime())) {
        return dateStr; // å¦‚æœè½‰å¤±æ•—ï¼Œå°±åŸæ¨£é¡¯ç¤º
      }

      const month = date.getMonth() + 1;
      const day = date.getDate();
      const weekdayNames = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
      const weekday = weekdayNames[date.getDay()];

      return `${month}/${day}ï¼ˆ${weekday}ï¼‰`;
    }
  </script>
</body>
</html>

